<!DOCTYPE html>
<html>
<head>
  <title>Match Simulator and Rating Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 40px;
      background-color: #f2f2f2;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
    }
    button:hover {
      background-color: #0056b3;
    }
    .section {
      margin-top: 30px;
      display: none;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      position: relative;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type=number] {
      padding: 6px;
      width: 100%;
      font-size: 16px;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    #settingsToggle {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #ffc107;
      color: black;
      z-index: 1000;
      border-radius: 6px;
      border: none;
      padding: 8px 12px;
      user-select: none;
    }
    #settingsPanel {
      display: none;
      position: fixed;
      top: 50px;
      right: 10px;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.15);
      z-index: 999;
      text-align: left;
      width: 220px;
      font-weight: normal;
      font-size: 14px;
    }
    #detailedOutput {
      font-size: 14px;
      color: #555;
      margin-top: 10px;
      font-family: monospace;
      white-space: pre-line;
      min-height: 60px;
    }
  </style>
</head>
<body>

  <h1>Match Simulator - Rating Calculator</h1>

  <button onclick="showSection('match')">Match Simulator</button>
  <button onclick="showSection('market')">Rating Calculator</button>

  <button id="settingsToggle" onclick="toggleSettings()">Settings</button>
  <div id="settingsPanel">
    <label><input type="checkbox" id="homeAdvantage"> Home Advantage</label>
    <label><input type="checkbox" id="detailedAnalysis"> Detailed Analysis</label>
  </div>

  <div id="match" class="section">
    <h2>⚽ Match Simulator</h2>
    <label>Team A Rating:</label>
    <input id="ratingA" type="number" value="20" min="0" max="100"><br>

    <label>Team B Rating:</label>
    <input id="ratingB" type="number" value="20" min="0" max="100"><br>

    <button onclick="simulateMatch()">Simulate Match</button>
    <h3 id="result"></h3>
    <div id="detailedOutput"></div>
  </div>

  <div id="market" class="section">
    <h2>Market Value - FIFA Rating Calculator</h2>

    <label>Player Market Value (€ Million):</label>
    <input id="marketValue" type="number" value="87" min="0" step="0.01"><br>

    <label>Player Age:</label>
    <input id="playerAge" type="number" value="23" min="10" max="50"><br>

    <button onclick="calculateRating()">Calculate FIFA Rating</button>

    <h3 id="ratingResult"></h3>
  </div>

  <script>
    function showSection(section) {
      document.querySelectorAll('.section').forEach(div => div.style.display = 'none');
      document.getElementById(section).style.display = 'block';
      clearResults();
    }

    function toggleSettings() {
      const panel = document.getElementById("settingsPanel");
      panel.style.display = (panel.style.display === "block") ? "none" : "block";
    }

    function clearResults() {
      document.getElementById("result").innerText = "";
      document.getElementById("detailedOutput").innerText = "";
    }

    document.addEventListener('DOMContentLoaded', () => {
      showSection('match');
    });

    function simulateMatch() {
      clearResults();

      const ratingA = parseInt(document.getElementById("ratingA").value);
      const ratingB = parseInt(document.getElementById("ratingB").value);
      const homeAdvantageChecked = document.getElementById("homeAdvantage").checked;
      const detailedChecked = document.getElementById("detailedAnalysis").checked;

      const differenceRaw = Math.abs(ratingA - ratingB);
      const differenceNorm = differenceRaw / 22;
      const totalGoals = 1 + (differenceNorm * 2) * 5;
      const goalDifferenceFactor = Math.max(0.05, 1 - (differenceNorm * 2));

      let teamAStrength = ratingA / (ratingA + ratingB);
      let teamBStrength = ratingB / (ratingA + ratingB);

      if (homeAdvantageChecked) {
        teamAStrength += 0.05;
      }

      // Normalize strengths
      const totalStrength = teamAStrength + teamBStrength;
      teamAStrength /= totalStrength;
      teamBStrength /= totalStrength;

      let goalsA = totalGoals * teamAStrength;
      let goalsB = totalGoals * teamBStrength;

      // Apply goal difference factor to weaker team
      const weaker = ratingA < ratingB ? 'A' : 'B';
      if (weaker === 'A') {
        goalsA *= goalDifferenceFactor;
      } else {
        goalsB *= goalDifferenceFactor;
      }

      // Round scores for initial calculations
      const baseA = Math.round(goalsA);
      const baseB = Math.round(goalsB);

      // Generate detailed scores and percentages
      let scores = [];

      if (differenceRaw === 0) {
        // If equal strength, favor draws
        scores = [
          { score: `1-1`, percent: 40 + Math.floor(Math.random() * 10) },
          { score: `0-0`, percent: 30 + Math.floor(Math.random() * 10) },
          { score: `2-2`, percent: 20 + Math.floor(Math.random() * 10) }
        ];
      } else {
        scores = [
          { score: `${baseA}-${baseB}`, percent: 50 + Math.floor(Math.random() * 15) },
          { score: `${baseA}-${baseB + 1}`, percent: 20 + Math.floor(Math.random() * 10) },
          { score: `${baseA + 1}-${baseB}`, percent: 15 + Math.floor(Math.random() * 10) }
        ];
      }

      // Sort by percent descending to find highest probability
      scores.sort((a,b) => b.percent - a.percent);

      // Main score is the one with highest percent
      const mainScore = scores[0].score;

      // Show main result
      document.getElementById("result").innerText = `Score: Team A ${mainScore.split('-')[0]} - ${mainScore.split('-')[1]} Team B`;

      // Show detailed analysis if checked
      if (detailedChecked) {
        let text = "";
        scores.forEach((item, i) => {
          text += `${i + 1}. ${item.score} %${item.percent}\n`;
        });
        document.getElementById("detailedOutput").innerText = text;
      }
    }

    function calculateRating() {
      const marketValue = parseFloat(document.getElementById("marketValue").value);
      const age = parseInt(document.getElementById("playerAge").value);

      if (marketValue <= 0) {
        document.getElementById("ratingResult").innerText = "Market value must be greater than 0.";
        return;
      }
      if (age < 14 || age > 50) {
        document.getElementById("ratingResult").innerText = "Age must be between 14 and 50.";
        return;
      }

      let ageFactor;
      if (age <= 18) ageFactor = 2.0;
      else if (age <= 20) ageFactor = 1.8;
      else if (age <= 23) ageFactor = 1.55;
      else if (age <= 26) ageFactor = 1.2;
      else if (age <= 29) ageFactor = 1;
      else if (age <= 32) ageFactor = 0.79;
      else if (age <= 35) ageFactor = 0.54;
      else if (age <= 37) ageFactor = 0.45;
      else ageFactor = 0.35;

      const baseFactor = 0.00000711;
      const rating = (1 / 0.1885) * Math.log(marketValue / (baseFactor * ageFactor));
      const finalRating = Math.round(rating);

      document.getElementById("ratingResult").innerText = `Estimated FIFA Rating: ${finalRating}`;
    }
  </script>

</body>
</html>

